# 2020语言与智能技术竞赛：事件抽取任务 比赛日志


## 赛前准备 2020/3/31

报名后把比赛的信息保存下来，阅读了比赛的数据格式，提交格式等内容；
整理思路，准备使用keras框架，BERT+BiLSTM+CRF方式做NER；

## baseline运行 2020/4/1

下载了苏神的baseline，准备先跑通一下。

运行后到了计算的时候，发现服务器重启了...之前也出现过这样的情况，
应该就是调用cuda的时候发生了错误，原因是版本不对。

为了以后能够正常跑比赛，决定把所有的版本都做下升级：
驱动: 440+
tensorflow_gpu: 1.14
cuda:1.10
cuDNN: 7.4 

各种折腾后终于完成了环境的版本升级，可以开始跑模型了。
对代码稍做了修改，便于使用：

训练模型：
```
python ee.py train
```
预测结果：

```
python ee.py predict
```

## 第1次提交 2020/4/3

经过一个晚上的计算（估算了一下，大约需要6.5个小时），在训练集上得到了`F1=0.766`的结果。
预测结果并提交，成绩为`0.776`：

```
团队成员用户名	precision	recall	f1_score	提交状态	提交时间
	
可西哥  0.807	0.748	0.776	完成	2020-04-03 08:50

```


## 使用BiLSTM

看了下网络结构，目前是BERT+CRF的结构，应该可以再加上BiLSTM进行优化，
LSTM层的大小设置为 `num_labels // 2`
修改模型后另存为：`ee_bilstm.py`, 开始训练, 一轮迭代需要35分钟，20轮预计时间为：11.7小时

训练集结果为0.767
预测结果并提交，成绩为：0.791	0.749	0.769

-----------------------------------------
## 训练日志
2020/4/8

训练文件：ee_1.py
加大CRF层的学习率：从100改为200；把学习率从2e-5降为1e-5，

开始训练：

```
python3.5 ee_1.py 
```

训练结果：
```
验证集：f1: 0.7955, precision: 0.7980, recall: 0.7931, best f1: 0.7993
```
得分最高的模型为：`model_13_dev_0.7993.weights`

预测结果：
```
python3.5 ee_1.py predict model_13_dev_0.7993.weights
```
生成提交结果文件： `pred_20200408195127.json`

提交结果，最终得分为：
```
precision	recall	f1_score
0.835	0.786	0.81
```


## BiLSTM模型训练
2020/4/7
在原来的模型ee.py基础上，加上BiLSTM层，
程序文件：`ee_bilstm.py`, 跑完分数为0.769；


把新的抽取函数`extract_arguments`复制过来，
加大CRF层的学习率：从100改为200；其它层学习率仍然保持`2e-5`

模型结构为：
```
Transformer-23-FeedForward-Norm (None, None, 1024)   2048        Transformer-23-FeedForward-Add[0]
__________________________________________________________________________________________________
dense_145 (Dense)               (None, None, 870)    891750      Transformer-23-FeedForward-Norm[0
__________________________________________________________________________________________________
bidirectional_1 (Bidirectional) (None, None, 870)    4544880     dense_145[0][0]
__________________________________________________________________________________________________
dropout_1 (Dropout)             (None, None, 870)    0           bidirectional_1[0][0]
__________________________________________________________________________________________________
dense_146 (Dense)               (None, None, 435)    378885      dropout_1[0][0]
__________________________________________________________________________________________________
dropout_2 (Dropout)             (None, None, 435)    0           dense_146[0][0]
__________________________________________________________________________________________________
conditional_random_field_1 (Con (None, None, 435)    189225      dropout_2[0][0]
==================================================================================================
Total params: 330,477,572
Trainable params: 330,477,572
Non-trainable params: 0

```

开始训练：

```
export CUDA_VISIBLE_DEVICES=1
python3.5 ee_bilstm_1.py
```

训练后最好的模型得分：`BiLSTM_model_13_dev_0.7879.weights`

预测结果：

```
python3.5 ee_bilstm_1.py predict BiLSTM_model_13_dev_0.7879.weights
save to ./pred_20200409092740.json
```

提交预测结果，最终得分为：
```
precision	recall	f1_score
0.845	0.768	0.805
```
可以看出recall降价了，也就是TP数量减少了；

-----------------------------------------
训练文件：ee_1.py
加大CRF层的学习率：改为300；把学习率改为5e-5，

开始训练：

```
python3.5 ee_1.py 
```



